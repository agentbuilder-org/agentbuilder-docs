---
title: 'FlowState'
description: 'The runtime context object that flows through agent execution'
---

## What is FlowState?

FlowState is the central state object that flows through the entire execution lifecycle of an agent. It contains all the information about the current execution: conversation history, tool calls, configuration, storage access, and more.

FlowState is available in **tool handlers** and **hooks**, providing a complete view of the execution context and utilities to modify it.

## FlowState Interface

```typescript
interface FlowState {
  // Identity
  threadId: string;              // Unique thread identifier
  flowId: string;                // Unique flow execution identifier

  // Thread reference
  thread: {
    instance: ThreadInstance;    // DurableObject instance
    metadata: ThreadMetadata;    // Thread metadata
  };

  // Configuration
  agentConfig: Agent;            // Complete agent configuration
  currentSide: "a" | "b";        // Current executing side

  // Execution tracking
  turnCount: number;             // Current turn number
  stopped: boolean;              // Whether execution should stop
  stoppedBy?: "a" | "b";         // Which side triggered stop

  // Message context
  messageHistory: Message[];     // Full conversation history

  // Tool execution queue
  sequence: {
    queue: ToolCall[];           // Pending tool calls
    isHandling: boolean;         // Currently processing queue
  };

  // Storage & environment
  storage: DurableObjectStorage; // DurableObject SQLite storage
  env: ThreadEnv;                // Cloudflare environment bindings

  // Runtime context
  context: Record<string, unknown>; // Arbitrary state data

  // Hierarchical tracking (for sub-prompts)
  rootState?: FlowState;         // Reference to root FlowState
  isChildPrompt?: boolean;       // Is this a sub-prompt execution?
}
```

## Accessing FlowState

FlowState is passed as the first argument to tool handlers and hooks:

<Tabs>
  <Tab title="In Tools">
    ```typescript
    import { defineTool } from "@standardagents/builder";
    import { z } from "zod";

    export default defineTool(
      "Example tool",
      z.object({ input: z.string() }),
      async (flow, args) => {
        // Access FlowState properties
        console.log("Thread ID:", flow.threadId);
        console.log("Turn count:", flow.turnCount);
        console.log("Message count:", flow.messageHistory.length);

        return {
          status: "success",
          result: "Done",
        };
      }
    );
    ```
  </Tab>
  <Tab title="In Hooks">
    ```typescript
    import { defineHook } from "@standardagents/builder";

    export default defineHook("beforeRequest", async (flow) => {
      // Access FlowState properties
      console.log("Thread ID:", flow.threadId);
      console.log("Current side:", flow.currentSide);

      // Modify context
      flow.context.startTime = Date.now();
    });
    ```
  </Tab>
</Tabs>

## Key Properties

### Identity

| Property | Type | Description |
|----------|------|-------------|
| `threadId` | `string` | Unique identifier for the conversation thread |
| `flowId` | `string` | Unique identifier for this specific execution flow |

### Configuration

| Property | Type | Description |
|----------|------|-------------|
| `agentConfig` | `Agent` | Complete agent configuration object |
| `currentSide` | `"a" \| "b"` | Which side is currently executing |

### Execution State

| Property | Type | Description |
|----------|------|-------------|
| `turnCount` | `number` | Current turn number |
| `stopped` | `boolean` | Whether execution has been stopped |
| `stoppedBy` | `"a" \| "b" \| undefined` | Which side triggered the stop |
| `messageHistory` | `Message[]` | Full conversation history |

### Tool Queue

| Property | Type | Description |
|----------|------|-------------|
| `sequence.queue` | `ToolCall[]` | Pending tool calls to execute |
| `sequence.isHandling` | `boolean` | Whether currently processing the queue |

### Environment

| Property | Type | Description |
|----------|------|-------------|
| `storage` | `DurableObjectStorage` | Access to DurableObject SQLite storage |
| `env` | `ThreadEnv` | Cloudflare environment bindings |
| `context` | `Record<string, unknown>` | Arbitrary runtime state data |

### Sub-Prompt Tracking

| Property | Type | Description |
|----------|------|-------------|
| `rootState` | `FlowState \| undefined` | Reference to root FlowState (in sub-prompts) |
| `isChildPrompt` | `boolean \| undefined` | Whether this is a sub-prompt execution |

## Common Types

### Message

```typescript
interface Message {
  id: string;
  role: "system" | "user" | "assistant" | "tool";
  content: string | null;
  name?: string | null;
  tool_calls?: string | null;
  tool_call_id?: string | null;
  log_id?: string | null;
  created_at: number;
  status?: "pending" | "completed" | "failed";
  silent?: boolean;
  depth?: number;
}
```

### ToolCall

```typescript
interface ToolCall {
  id: string;
  type: "function";
  function: {
    name: string;
    arguments: string; // JSON string
  };
}
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Utilities" icon="toolbox" href="/core-concepts/utilities">
    Functions to manipulate FlowState
  </Card>
  <Card title="Tools" icon="wrench" href="/core-concepts/tools">
    Create tools that use FlowState
  </Card>
  <Card title="Hooks" icon="hook" href="/core-concepts/hooks">
    Use FlowState in lifecycle hooks
  </Card>
  <Card title="React Integration" icon="react" href="/user-interfaces/react">
    Connect frontend to backend events
  </Card>
</CardGroup>
